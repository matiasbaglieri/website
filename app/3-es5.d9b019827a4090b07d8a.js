!function(){function t(t,i){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,i){if(!t)return;if("string"==typeof t)return e(t,i);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return e(t,i)}(t))||i&&t&&"number"==typeof t.length){n&&(t=n);var s=0,r=function(){};return{s:r,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,h=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){h=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(h)throw o}}}}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}function n(t){var e=h();return function(){var i,n=u(t);if(e){var r=u(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return s(this,i)}}function s(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?r(t):e}function r(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function o(t){var e="function"==typeof Map?new Map:void 0;return(o=function(t){if(null===t||(i=t,-1===Function.toString.call(i).indexOf("[native code]")))return t;var i;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return a(t,arguments,u(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),c(n,t)})(t)}function a(t,e,i){return(a=h()?Reflect.construct:function(t,e,i){var n=[null];n.push.apply(n,e);var s=new(Function.bind.apply(t,n));return i&&c(s,i.prototype),s}).apply(null,arguments)}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function p(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function l(t,e,i){return e&&p(t.prototype,e),i&&p(t,i),t}function g(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{NxW9:function(e,s,a){"use strict";a.d(s,"a",(function(){return m})),a.d(s,"b",(function(){return R})),a.d(s,"c",(function(){return F}));var h=a("fXoL"),c=a("ofXK"),u=["cropcanvas"],p=["fileInput"];function d(t,e){if(1&t){var i=h["\u0275\u0275getCurrentView"]();h["\u0275\u0275elementStart"](0,"input",4,5),h["\u0275\u0275listener"]("change",(function(t){return h["\u0275\u0275restoreView"](i),h["\u0275\u0275nextContext"]().fileChangeListener(t)})),h["\u0275\u0275elementEnd"]()}}var f=function t(e){g(this,t),this.lineDash=!1,this.strokeWidth=1,this.strokeColor="rgba(255,255,255,1)",this.fillColor="rgba(255,255,255,1)",this.dragIconStrokeWidth=1,this.dragIconStrokeColor="rgba(0,0,0,1)",this.dragIconFillColor="rgba(255,255,255,1)",this.backgroundFillColor="rgba(0,0,0,0.6)","object"==typeof e&&(this.lineDash=e.lineDash||this.lineDash,this.strokeWidth=e.strokeWidth||this.strokeWidth,this.fillColor=e.fillColor||this.fillColor,this.strokeColor=e.strokeColor||this.strokeColor,this.dragIconStrokeWidth=e.dragIconStrokeWidth||this.dragIconStrokeWidth,this.dragIconStrokeColor=e.dragIconStrokeColor||this.dragIconStrokeColor,this.dragIconFillColor=e.dragIconFillColor||this.dragIconFillColor,this.backgroundFillColor=e.backgroundFillColor||this.backgroundFillColor)},m=function(){function t(e){g(this,t),this.canvasWidth=300,this.canvasHeight=300,this.dynamicSizing=!1,this.width=200,this.height=200,this.minWidth=50,this.minHeight=50,this.minWithRelativeToResolution=!0,this.croppedWidth=100,this.croppedHeight=100,this.cropperDrawSettings=new f,this.touchRadius=20,this.noFileInput=!1,this.markerSizeMultiplier=1,this.centerTouchRadius=20,this.showCenterMarker=!0,this.allowedFilesRegex=/\.(jpe?g|png|gif|bmp)$/i,this.cropOnResize=!0,this.preserveSize=!1,this.compressRatio=1,this._rounded=!1,this._keepAspect=!0,"object"==typeof e&&Object.assign(this,e)}return l(t,[{key:"rounded",set:function(t){this._rounded=t,t&&(this._keepAspect=!0)},get:function(){return this._rounded}},{key:"keepAspect",set:function(t){this._keepAspect=t,!0===this._rounded&&!1===this._keepAspect&&(console.error("Cannot set keep aspect to false on rounded cropper. Ellipsis not supported"),this._keepAspect=!0)},get:function(){return this._keepAspect}}]),t}(),v=function(t){i(s,t);var e=n(s);function s(){return g(this,s),e.apply(this,arguments)}return s}(o(Number)),w=function(){function t(){g(this,t),this.debug=!1,this.IptcFieldMap={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"},this.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},this.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},this.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},this.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}}}return l(t,[{key:"addEvent",value:function(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent&&t.attachEvent("on"+e,i)}},{key:"imageHasData",value:function(t){return!!t.exifdata}},{key:"base64ToArrayBuffer",value:function(t){t=t.replace(/^data:([^;]+);base64,/gim,"");for(var e=atob(t),i=e.length,n=new ArrayBuffer(i),s=new Uint8Array(n),r=0;r<i;r++)s[r]=e.charCodeAt(r);return n}},{key:"objectURLToBlob",value:function(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="blob",i.onload=function(){200!==i.status&&0!==i.status||e(i.response)},i.send()}},{key:"getImageData",value:function(t,e){var i=this,n=function(n){var s=i.findEXIFinJPEG(n),r=i.findIPTCinJPEG(n);t.exifdata=s||{},t.iptcdata=r||{},e&&e.call(t)};if("src"in t&&t.src)if(/^data:/i.test(t.src)){var s=this.base64ToArrayBuffer(t.src);n(s)}else if(/^blob:/i.test(t.src)){var r=new FileReader;r.onload=function(t){n(t.target.result)},this.objectURLToBlob(t.src,(function(t){r.readAsArrayBuffer(t)}))}else{var o=new XMLHttpRequest;o.onload=function(){if(200!==o.status&&0!==o.status)throw new Error("Could not load image");n(o.response)},o.open("GET",t.src,!0),o.responseType="arraybuffer",o.send(null)}else if(FileReader&&(t instanceof Blob||t instanceof File)){var a=new FileReader;a.onload=function(t){i.log("Got file of length "+t.target.result.byteLength),n(t.target.result)},a.readAsArrayBuffer(t)}}},{key:"findEXIFinJPEG",value:function(t){var e=new DataView(t);if(this.log("Got file of length "+t.byteLength),255!==e.getUint8(0)||216!==e.getUint8(1))return this.log("Not a valid JPEG"),!1;for(var i,n=2,s=t.byteLength;n<s;){if(255!==e.getUint8(n))return this.log("Not a valid marker at offset "+n+", found: "+e.getUint8(n)),!1;if(i=e.getUint8(n+1),this.log(i),225===i)return this.log("Found 0xFFE1 marker"),this.readEXIFData(e,n+4);n+=2+e.getUint16(n+2)}}},{key:"findIPTCinJPEG",value:function(t){var e=new DataView(t);if(this.log("Got file of length "+t.byteLength),255!==e.getUint8(0)||216!==e.getUint8(1))return this.log("Not a valid JPEG"),!1;for(var i,n,s=2,r=t.byteLength;s<r;){if(56===(i=e).getUint8(n=s)&&66===i.getUint8(n+1)&&73===i.getUint8(n+2)&&77===i.getUint8(n+3)&&4===i.getUint8(n+4)&&4===i.getUint8(n+5)){var o=e.getUint8(s+7);o%2!=0&&(o+=1),0===o&&(o=4);var a=s+8+o,h=e.getUint16(s+6+o);return this.readIPTCData(t,a,h)}s++}}},{key:"readIPTCData",value:function(t,e,i){for(var n,s,r,o,a=new DataView(t),h={},c=e;c<e+i;)28===a.getUint8(c)&&2===a.getUint8(c+1)&&((o=a.getUint8(c+2))in this.IptcFieldMap&&((r=a.getInt16(c+3))+5,s=this.IptcFieldMap[o],n=this.getStringFromDB(a,c+5,r),h.hasOwnProperty(s)?h[s]instanceof Array?h[s].push(n):h[s]=[h[s],n]:h[s]=n)),c++;return h}},{key:"readTags",value:function(t,e,i,n,s){for(var r,o,a=t.getUint16(i,!s),h={},c=0;c<a;c++)r=i+12*c+2,(o=n[t.getUint16(r,!s)])||this.log("Unknown tag: "+t.getUint16(r,!s)),h[o]=this.readTagValue(t,r,e,i,s);return h}},{key:"readTagValue",value:function(t,e,i,n,s){var r,o,a,h,c,u,p=t.getUint16(e+2,!s),l=t.getUint32(e+4,!s),g=t.getUint32(e+8,!s)+i;switch(p){case 1:case 7:if(1===l)return t.getUint8(e+8,!s);for(r=l>4?g:e+8,o=[],h=0;h<l;h++)o[h]=t.getUint8(r+h);return o;case 2:return r=l>4?g:e+8,this.getStringFromDB(t,r,l-1);case 3:if(1===l)return t.getUint16(e+8,!s);for(r=l>2?g:e+8,o=[],h=0;h<l;h++)o[h]=t.getUint16(r+2*h,!s);return o;case 4:if(1===l)return t.getUint32(e+8,!s);for(o=[],h=0;h<l;h++)o[h]=t.getUint32(g+4*h,!s);return o;case 5:if(1===l)return c=t.getUint32(g,!s),u=t.getUint32(g+4,!s),(a=new v(c/u)).numerator=c,a.denominator=u,a;for(o=[],h=0;h<l;h++)c=t.getUint32(g+8*h,!s),u=t.getUint32(g+4+8*h,!s),o[h]=new v(c/u),o[h].numerator=c,o[h].denominator=u;return o;case 9:if(1===l)return t.getInt32(e+8,!s);for(o=[],h=0;h<l;h++)o[h]=t.getInt32(g+4*h,!s);return o;case 10:if(1===l)return t.getInt32(g,!s)/t.getInt32(g+4,!s);for(o=[],h=0;h<l;h++)o[h]=t.getInt32(g+8*h,!s)/t.getInt32(g+4+8*h,!s);return o}}},{key:"getStringFromDB",value:function(t,e,i){for(var n="",s=e;s<e+i;s++)n+=String.fromCharCode(t.getUint8(s));return n}},{key:"readEXIFData",value:function(t,e){if("Exif"!==this.getStringFromDB(t,e,4))return this.log("Not valid EXIF data! "+this.getStringFromDB(t,e,4)),!1;var i,n,s,r,o,a=e+6;if(18761===t.getUint16(a))i=!1;else{if(19789!==t.getUint16(a))return this.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;i=!0}if(42!==t.getUint16(a+2,!i))return this.log("Not valid TIFF data! (no 0x002A)"),!1;var h=t.getUint32(a+4,!i);if(h<8)return this.log("Not valid TIFF data! (First offset less than 8)",t.getUint32(a+4,!i)),!1;if((n=this.readTags(t,a,a+h,this.TiffTags,i)).ExifIFDPointer)for(s in r=this.readTags(t,a,a+n.ExifIFDPointer,this.Tags,i))if({}.hasOwnProperty.call(r,s)){switch(s){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":r[s]=this.StringValues[s][r[s]];break;case"ExifVersion":case"FlashpixVersion":r[s]=String.fromCharCode(r[s][0],r[s][1],r[s][2],r[s][3]);break;case"ComponentsConfiguration":r[s]=this.StringValues.Components[r[s][0]]+this.StringValues.Components[r[s][1]]+this.StringValues.Components[r[s][2]]+this.StringValues.Components[r[s][3]]}n[s]=r[s]}if(n.GPSInfoIFDPointer)for(s in o=this.readTags(t,a,a+n.GPSInfoIFDPointer,this.GPSTags,i))if({}.hasOwnProperty.call(o,s)){switch(s){case"GPSVersionID":o[s]=o[s][0]+"."+o[s][1]+"."+o[s][2]+"."+o[s][3]}n[s]=o[s]}return n}},{key:"checkImageType",value:function(t){return t instanceof Image||t instanceof HTMLImageElement}},{key:"getData",value:function(t,e){return!(this.checkImageType(t)&&!t.complete||(this.imageHasData(t)?e&&e.call(t):this.getImageData(t,e),0))}},{key:"getTag",value:function(t,e){if(this.imageHasData(t))return t.exifdata[e]}},{key:"getAllTags",value:function(t){if(!this.imageHasData(t))return{};var e,i=t.exifdata,n={};for(e in i)i.hasOwnProperty(e)&&(n[e]=i[e]);return n}},{key:"pretty",value:function(t){if(!this.imageHasData(t))return"";var e,i=t.exifdata,n="";for(e in i)i.hasOwnProperty(e)&&(n+="object"==typeof i[e]?i[e]instanceof Number?"".concat(e," : ").concat(i[e]," [").concat(i[e].numerator,"/").concat(i[e].denominator,"]\r\n"):"".concat(e," : [").concat(i[e].length," values]\r\n"):"".concat(e," : ").concat(i[e],"\r\n"));return n}},{key:"readFromBinaryFile",value:function(t){return this.findEXIFinJPEG(t)}},{key:"log",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.debug&&console.log(e)}}]),t}(),y=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;g(this,t),this.x=e,this.y=i}return l(t,[{key:"next",get:function(){return this.myNext},set:function(t){this.myNext=t}},{key:"prev",get:function(){return this.myPrev},set:function(t){this.myPrev=t}}]),t}(),b=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;g(this,t);for(var i=this.firstAvailable=new y,n=1;n<e;n++){var s=new y;i.next=s,i=s}}return l(t,[{key:"borrow",value:function(t,e){if(null==this.firstAvailable)throw new Error("Pool exhausted");this.borrowed++;var i=this.firstAvailable;return this.firstAvailable=i.next,i.x=t,i.y=e,i}},{key:"returnPoint",value:function(t){this.borrowed--,t.x=0,t.y=0,t.next=this.firstAvailable,this.firstAvailable=t}},{key:"instance",get:function(){return this}}]),t}(),C=function(){function t(e,i,n,s){g(this,t),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=0),this.left=e,this.right=e+n,this.top=i,this.bottom=i+s}return l(t,[{key:"getCentre",value:function(){var t=this.width,e=this.height;return(new b).instance.borrow(this.left+t/2,this.top+e/2)}},{key:"width",get:function(){return this.right-this.left}},{key:"height",get:function(){return this.bottom-this.top}}]),t}(),S=function(){function t(e,i,n,s){g(this,t),this.cropperSettings=new m,this.over=!1,this.drag=!1,this._position=new y(e,i),this.offset=new y(0,0),this.radius=n,this.cropperSettings=s}return l(t,[{key:"setDrag",value:function(t){this.drag=t,this.setOver(t)}},{key:"draw",value:function(t){}},{key:"setOver",value:function(t){this.over=t}},{key:"touchInBounds",value:function(t,e){return t>this.position.x-this.radius+this.offset.x&&t<this.position.x+this.radius+this.offset.x&&e>this.position.y-this.radius+this.offset.y&&e<this.position.y+this.radius+this.offset.y}},{key:"setPosition",value:function(t,e){this._position.x=t,this._position.y=e}},{key:"position",get:function(){return this._position}}]),t}(),x=function(t){i(s,t);var e=n(s);function s(t,i,n,r){return g(this,s),e.call(this,t,i,n,r)}return l(s,[{key:"drawCornerBorder",value:function(t){var e=10;(this.over||this.drag)&&(e=12);var i=this.cropperSettings.markerSizeMultiplier,n=this.cropperSettings.markerSizeMultiplier;this.horizontalNeighbour.position.x<this.position.x&&(i=-this.cropperSettings.markerSizeMultiplier),this.verticalNeighbour.position.y<this.position.y&&(n=-this.cropperSettings.markerSizeMultiplier),t.beginPath(),this.cropperSettings.cropperDrawSettings.lineDash&&t.setLineDash([1,3]),t.lineJoin="miter",t.moveTo(this.position.x+this.offset.x,this.position.y+this.offset.y),t.lineTo(this.position.x+this.offset.x+e*i,this.position.y+this.offset.y),t.lineTo(this.position.x+this.offset.x+e*i,this.position.y+this.offset.y+e*n),t.lineTo(this.position.x+this.offset.x,this.position.y+this.offset.y+e*n),t.lineTo(this.position.x+this.offset.x,this.position.y+this.offset.y),t.closePath(),t.lineWidth=this.cropperSettings.cropperDrawSettings.strokeWidth,t.strokeStyle=this.cropperSettings.cropperDrawSettings.strokeColor||"rgba(255,255,255,.7)",t.stroke()}},{key:"drawCornerFill",value:function(t){var e=10;(this.over||this.drag)&&(e=12);var i=this.cropperSettings.markerSizeMultiplier,n=this.cropperSettings.markerSizeMultiplier;if(this.horizontalNeighbour.position.x<this.position.x&&(i=-this.cropperSettings.markerSizeMultiplier),this.verticalNeighbour.position.y<this.position.y&&(n=-this.cropperSettings.markerSizeMultiplier),this.cropperSettings.rounded){var s=this.position.x-this.horizontalNeighbour.position.x,r=this.position.y-this.verticalNeighbour.position.y,o=Math.round(Math.sin(Math.PI/2)*Math.abs(s/2))/4,a=Math.round(Math.sin(Math.PI/2)*Math.abs(r/2))/4;this.offset.x=i>0?o:-o,this.offset.y=n>0?a:-a}else this.offset.x=0,this.offset.y=0;t.beginPath(),this.cropperSettings.cropperDrawSettings.lineDash&&t.setLineDash([1,3]),t.moveTo(this.position.x+this.offset.x,this.position.y+this.offset.y),t.lineTo(this.position.x+this.offset.x+e*i,this.position.y+this.offset.y),t.lineTo(this.position.x+this.offset.x+e*i,this.position.y+this.offset.y+e*n),t.lineTo(this.position.x+this.offset.x,this.position.y+this.offset.y+e*n),t.lineTo(this.position.x+this.offset.x,this.position.y+this.offset.y),t.closePath(),t.fillStyle=this.cropperSettings.cropperDrawSettings.fillColor||"rgba(255,255,255,.7)",t.fill()}},{key:"moveX",value:function(t){this.setPosition(t,this.position.y)}},{key:"moveY",value:function(t){this.setPosition(this.position.x,t)}},{key:"move",value:function(t,e){this.setPosition(t,e),this.verticalNeighbour.moveX(t),this.horizontalNeighbour.moveY(e)}},{key:"addHorizontalNeighbour",value:function(t){this.horizontalNeighbour=t}},{key:"addVerticalNeighbour",value:function(t){this.verticalNeighbour=t}},{key:"getHorizontalNeighbour",value:function(){return this.horizontalNeighbour}},{key:"getVerticalNeighbour",value:function(){return this.verticalNeighbour}},{key:"draw",value:function(t){this.drawCornerFill(t),this.drawCornerBorder(t)}}]),s}(S),I=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;g(this,t),this.id=n,this.x=e,this.y=i},k=function(e){i(r,e);var s=n(r);function r(t,e,i,n){var o;return g(this,r),(o=s.call(this,t,e,i,n)).iconPoints=[],o.scaledIconPoints=[],o.getDragIconPoints(o.iconPoints,1),o.getDragIconPoints(o.scaledIconPoints,1.2),o}return l(r,[{key:"draw",value:function(t){this.drawIcon(t,this.over||this.drag?this.scaledIconPoints:this.iconPoints)}},{key:"getDragIconPoints",value:function(t,e){var i=17*e,n=14*e,s=8*e,r=4*e;t.push((new b).instance.borrow(-r/2,i-s)),t.push((new b).instance.borrow(-n/2,i-s)),t.push((new b).instance.borrow(0,i)),t.push((new b).instance.borrow(n/2,i-s)),t.push((new b).instance.borrow(r/2,i-s)),t.push((new b).instance.borrow(r/2,r/2)),t.push((new b).instance.borrow(i-s,r/2)),t.push((new b).instance.borrow(i-s,n/2)),t.push((new b).instance.borrow(i,0)),t.push((new b).instance.borrow(i-s,-n/2)),t.push((new b).instance.borrow(i-s,-r/2)),t.push((new b).instance.borrow(r/2,-r/2)),t.push((new b).instance.borrow(r/2,-i+s)),t.push((new b).instance.borrow(n/2,-i+s)),t.push((new b).instance.borrow(0,-i)),t.push((new b).instance.borrow(-n/2,-i+s)),t.push((new b).instance.borrow(-r/2,-i+s)),t.push((new b).instance.borrow(-r/2,-r/2)),t.push((new b).instance.borrow(-i+s,-r/2)),t.push((new b).instance.borrow(-i+s,-n/2)),t.push((new b).instance.borrow(-i,0)),t.push((new b).instance.borrow(-i+s,n/2)),t.push((new b).instance.borrow(-i+s,r/2)),t.push((new b).instance.borrow(-r/2,r/2))}},{key:"drawIcon",value:function(e,i){if(this.cropperSettings.showCenterMarker){e.beginPath(),e.moveTo(i[0].x+this.position.x,i[0].y+this.position.y);var n,s=t(i);try{for(s.s();!(n=s.n()).done;){var r=n.value;e.lineTo(r.x+this.position.x,r.y+this.position.y)}}catch(o){s.e(o)}finally{s.f()}e.closePath(),e.fillStyle=this.cropperSettings.cropperDrawSettings.dragIconFillColor,e.fill(),e.lineWidth=this.cropperSettings.cropperDrawSettings.dragIconStrokeWidth,e.strokeStyle=this.cropperSettings.cropperDrawSettings.dragIconStrokeColor,e.stroke()}}},{key:"recalculatePosition",value:function(t){var e=t.getCentre();this.setPosition(e.x,e.y),(new b).instance.returnPoint(e)}}]),r}(S),P=function(){function t(){g(this,t),this.share={}}return l(t,[{key:"setPressed",value:function(t){this.pressed=t}},{key:"setReleased",value:function(t){}},{key:"setOver",value:function(t){this.over=t}},{key:"setStyle",value:function(t,e){}}]),t}(),D=function(e){i(o,e);var s=n(o);function o(t){var e;g(this,o),(e=s.call(this)).imageCropperDataShare=new P;var i=t.width,n=t.height,a=t.keepAspect,h=t.touchRadius,c=t.centerTouchRadius,u=t.minWidth,p=t.minHeight,l=t.croppedWidth,d=t.croppedHeight;return e.cropperSettings=t,e.crop=r(e),e.x=0,e.y=0,e.canvasHeight=t.canvasHeight,e.canvasWidth=t.canvasWidth,e.width=i,void 0===i&&(e.width=100),e.height=n,void 0===n&&(e.height=50),e.keepAspect=a,void 0===a&&(e.keepAspect=!0),e.touchRadius=h,void 0===h&&(e.touchRadius=20),e.minWidth=u,e.minHeight=p,e.aspectRatio=0,e.currentDragTouches=[],e.isMouseDown=!1,e.ratioW=1,e.ratioH=1,e.fileType=t.fileType,e.imageSet=!1,e.pointPool=new b(200),e.tl=new x(0,0,h,e.cropperSettings),e.tr=new x(0+i,0,h,e.cropperSettings),e.bl=new x(0,0+n,h,e.cropperSettings),e.br=new x(0+i,0+n,h,e.cropperSettings),e.tl.addHorizontalNeighbour(e.tr),e.tl.addVerticalNeighbour(e.bl),e.tr.addHorizontalNeighbour(e.tl),e.tr.addVerticalNeighbour(e.br),e.bl.addHorizontalNeighbour(e.br),e.bl.addVerticalNeighbour(e.tl),e.br.addHorizontalNeighbour(e.bl),e.br.addVerticalNeighbour(e.tr),e.markers=[e.tl,e.tr,e.bl,e.br],e.center=new k(0+i/2,0+n/2,c,e.cropperSettings),e.aspectRatio=n/i,e.croppedImage=new Image,e.currentlyInteracting=!1,e.cropWidth=l,e.cropHeight=d,e}return l(o,[{key:"sign",value:function(t){return+t===t?0===t?t:t>0?1:-1:NaN}},{key:"getMousePos",value:function(t,e){var i=t.getBoundingClientRect();return(new b).instance.borrow(e.clientX-i.left,e.clientY-i.top)}},{key:"getTouchPos",value:function(t,e){var i=t.getBoundingClientRect();return(new b).instance.borrow(e.clientX-i.left,e.clientY-i.top)}},{key:"detectVerticalSquash",value:function(t){var e=t.height,i=document.createElement("canvas");i.width=1,i.height=e;var n=i.getContext("2d");n.drawImage(t,0,0);var s=n.getImageData(0,0,1,e);if(s){for(var r=s.data,o=0,a=e,h=e;h>o;)0===r[4*(h-1)+3]?a=h:o=h,h=a+o>>1;var c=h/e;return 0===c?1:c}return 1}},{key:"getDataUriMimeType",value:function(t){var e=t.substring(0,50),i="image/png",n=RegExp(/^(data:)([\w\/\+]+);(charset=[\w-]+|base64).*,(.*)/gi).exec(e);return n&&n[2]&&("image/jpg"===(i=n[2])&&(i="image/jpeg")),i}},{key:"prepare",value:function(t){this.buffer=document.createElement("canvas"),this.cropCanvas=document.createElement("canvas");var e=t.parentElement?t.parentElement.clientWidth:0;e>0&&this.cropperSettings.dynamicSizing?(this.cropCanvas.width=e,this.buffer.width=e,t.width=e):(this.cropCanvas.width=this.cropWidth,this.buffer.width=t.width),this.cropCanvas.height=this.cropHeight,this.buffer.height=t.height,this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.draw(this.ctx)}},{key:"updateSettings",value:function(t){this.cropperSettings=t}},{key:"resizeCanvas",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.canvas.width=this.cropCanvas.width=this.width=this.canvasWidth=this.buffer.width=t,this.canvas.height=this.cropCanvas.height=this.height=this.canvasHeight=this.buffer.height=e,i&&this.setImage(this.srcImage)}},{key:"reset",value:function(){this.setImage(void 0)}},{key:"draw",value:function(t){var e=this.getBounds();if(this.srcImage){t.clearRect(0,0,this.canvasWidth,this.canvasHeight);var i=this.srcImage.height/this.srcImage.width,n=this.canvasHeight/this.canvasWidth,s=this.canvasWidth,r=this.canvasHeight;n>i?(s=this.canvasWidth,r=this.canvasWidth*i):(r=this.canvasHeight,s=this.canvasHeight/i),this.ratioW=s/this.srcImage.width,this.ratioH=r/this.srcImage.height,n<i?this.drawImageIOSFix(t,this.srcImage,0,0,this.srcImage.width,this.srcImage.height,this.buffer.width/2-s/2,0,s,r):this.drawImageIOSFix(t,this.srcImage,0,0,this.srcImage.width,this.srcImage.height,0,this.buffer.height/2-r/2,s,r),this.buffer.getContext("2d").drawImage(this.canvas,0,0,this.canvasWidth,this.canvasHeight),t.lineWidth=this.cropperSettings.cropperDrawSettings.strokeWidth,t.strokeStyle=this.cropperSettings.cropperDrawSettings.strokeColor,t.fillStyle=this.cropperSettings.cropperDrawSettings.backgroundFillColor,this.cropperSettings.rounded?(t.fillRect(0,0,this.canvas.width,this.canvas.height),t.save(),t.beginPath(),t.arc(e.left+e.width/2,e.top+e.height/2,e.width/2,0,2*Math.PI),t.stroke(),t.clip(),n<i?this.drawImageIOSFix(t,this.srcImage,0,0,this.srcImage.width,this.srcImage.height,this.buffer.width/2-s/2,0,s,r):this.drawImageIOSFix(t,this.srcImage,0,0,this.srcImage.width,this.srcImage.height,0,this.buffer.height/2-r/2,s,r),t.restore()):(t.fillRect(0,0,this.canvasWidth,this.canvasHeight),t.drawImage(this.buffer,e.left,e.top,Math.max(e.width,1),Math.max(e.height,1),e.left,e.top,e.width,e.height),t.strokeRect(e.left,e.top,e.width,e.height));for(var o=0;o<this.markers.length;o++)this.markers[o].draw(t);this.center.draw(t)}else t.fillStyle="rgba(192,192,192,1)",t.fillRect(0,0,this.canvas.width,this.canvas.height)}},{key:"dragCenter",value:function(t,e,i){var n=this.getBounds(),s=t-n.width/2,r=e+n.height/2;t+n.width/2>=this.maxXClamp&&(t=this.maxXClamp-n.width/2),s<=this.minXClamp&&(t=n.width/2+this.minXClamp),e-n.height/2<this.minYClamp&&(e=n.height/2+this.minYClamp),r>=this.maxYClamp&&(e=this.maxYClamp-n.height/2),this.tl.moveX(t-n.width/2),this.tl.moveY(e-n.height/2),this.tr.moveX(t+n.width/2),this.tr.moveY(e-n.height/2),this.bl.moveX(t-n.width/2),this.bl.moveY(e+n.height/2),this.br.moveX(t+n.width/2),this.br.moveY(e+n.height/2),i.setPosition(t,e)}},{key:"enforceMinSize",value:function(t,e,i){var n=t-i.getHorizontalNeighbour().position.x,s=e-i.getVerticalNeighbour().position.y,r=this.minWidth-Math.abs(n),o=this.minHeight-Math.abs(s);return 0===n||0===s?(t=i.position.x,e=i.position.y,(new b).instance.borrow(t,e)):(this.keepAspect?r>0&&o/this.aspectRatio>0?r>o/this.aspectRatio?n<0?(t-=r,s<0?e-=r*this.aspectRatio:e+=r*this.aspectRatio):(t+=r,s<0?e-=r*this.aspectRatio:e+=r*this.aspectRatio):s<0?(e-=o,n<0?t-=o/this.aspectRatio:t+=o/this.aspectRatio):(e+=o,n<0?t-=o/this.aspectRatio:t+=o/this.aspectRatio):r>0?n<0?(t-=r,s<0?e-=r*this.aspectRatio:e+=r*this.aspectRatio):(t+=r,s<0?e-=r*this.aspectRatio:e+=r*this.aspectRatio):o>0&&(s<0?(e-=o,n<0?t-=o/this.aspectRatio:t+=o/this.aspectRatio):(e+=o,n<0?t-=o/this.aspectRatio:t+=o/this.aspectRatio)):(r>0&&(n<0?t-=r:t+=r),o>0&&(s<0?e-=o:e+=o)),(t<this.minXClamp||t>this.maxXClamp||e<this.minYClamp||e>this.maxYClamp)&&(t=i.position.x,e=i.position.y),(new b).instance.borrow(t,e))}},{key:"dragCorner",value:function(t,e,i){var n,s=0,r=0,o=0,a=0,h=0,c=0,u=0,p=0,l=0;if(this.keepAspect){if(o=(n=i.getHorizontalNeighbour().getVerticalNeighbour()).position.x,a=n.position.y,t<=n.position.x){if(e<=n.position.y){if(s=o-100/this.aspectRatio,r=a-100/this.aspectRatio*this.aspectRatio,(l=this.getSide((new b).instance.borrow(s,r),n.position,(new b).instance.borrow(t,e)))>0){c=(h=Math.abs(n.position.y-e))/this.aspectRatio,u=n.position.y-h,p=n.position.x-c;var g=this.enforceMinSize(p,u,i);i.move(g.x,g.y),(new b).instance.returnPoint(g)}else if(l<0){h=(c=Math.abs(n.position.x-t))*this.aspectRatio,u=n.position.y-h,p=n.position.x-c;var d=this.enforceMinSize(p,u,i);i.move(d.x,d.y),(new b).instance.returnPoint(d)}}else if(s=o-100/this.aspectRatio,r=a+100/this.aspectRatio*this.aspectRatio,(l=this.getSide((new b).instance.borrow(s,r),n.position,(new b).instance.borrow(t,e)))>0){h=(c=Math.abs(n.position.x-t))*this.aspectRatio,u=n.position.y+h,p=n.position.x-c;var f=this.enforceMinSize(p,u,i);i.move(f.x,f.y),(new b).instance.returnPoint(f)}else if(l<0){c=(h=Math.abs(n.position.y-e))/this.aspectRatio,u=n.position.y+h,p=n.position.x-c;var m=this.enforceMinSize(p,u,i);i.move(m.x,m.y),(new b).instance.returnPoint(m)}}else if(e<=n.position.y){if(s=o+100/this.aspectRatio,r=a-100/this.aspectRatio*this.aspectRatio,(l=this.getSide((new b).instance.borrow(s,r),n.position,(new b).instance.borrow(t,e)))<0){c=(h=Math.abs(n.position.y-e))/this.aspectRatio,u=n.position.y-h,p=n.position.x+c;var v=this.enforceMinSize(p,u,i);i.move(v.x,v.y),(new b).instance.returnPoint(v)}else if(l>0){h=(c=Math.abs(n.position.x-t))*this.aspectRatio,u=n.position.y-h,p=n.position.x+c;var w=this.enforceMinSize(p,u,i);i.move(w.x,w.y),(new b).instance.returnPoint(w)}}else if(s=o+100/this.aspectRatio,r=a+100/this.aspectRatio*this.aspectRatio,(l=this.getSide((new b).instance.borrow(s,r),n.position,(new b).instance.borrow(t,e)))<0){h=(c=Math.abs(n.position.x-t))*this.aspectRatio,u=n.position.y+h,p=n.position.x+c;var y=this.enforceMinSize(p,u,i);i.move(y.x,y.y),(new b).instance.returnPoint(y)}else if(l>0){c=(h=Math.abs(n.position.y-e))/this.aspectRatio,u=n.position.y+h,p=n.position.x+c;var C=this.enforceMinSize(p,u,i);i.move(C.x,C.y),(new b).instance.returnPoint(C)}}else{var S=this.enforceMinSize(t,e,i);i.move(S.x,S.y),(new b).instance.returnPoint(S)}this.center.recalculatePosition(this.getBounds())}},{key:"getSide",value:function(t,e,i){var n=this.sign((e.x-t.x)*(i.y-t.y)-(e.y-t.y)*(i.x-t.x));return(new b).instance.returnPoint(t),(new b).instance.returnPoint(i),n}},{key:"handleRelease",value:function(t){if(null!=t){for(var e=0,i=0;i<this.currentDragTouches.length;i++)t.id===this.currentDragTouches[i].id&&(this.currentDragTouches[i].dragHandle.setDrag(!1),e=i);this.currentDragTouches.splice(e,1),this.draw(this.ctx)}}},{key:"handleMove",value:function(e){for(var i=!1,n=0;n<this.currentDragTouches.length;n++)if(e.id===this.currentDragTouches[n].id&&null!=this.currentDragTouches[n].dragHandle){var s=this.currentDragTouches[n],r=this.clampPosition(e.x-s.dragHandle.offset.x,e.y-s.dragHandle.offset.y);e.x=r.x,e.y=r.y,(new b).instance.returnPoint(r),s.dragHandle instanceof x?this.dragCorner(e.x,e.y,s.dragHandle):this.dragCenter(e.x,e.y,s.dragHandle),this.currentlyInteracting=!0,i=!0,this.imageCropperDataShare.setPressed(this.canvas);break}if(!i){var o,a=t(this.markers);try{for(a.s();!(o=a.n()).done;){var h=o.value;if(h.touchInBounds(e.x,e.y)){e.dragHandle=h,this.currentDragTouches.push(e),h.setDrag(!0),e.dragHandle.offset.x=e.x-e.dragHandle.position.x,e.dragHandle.offset.y=e.y-e.dragHandle.position.y,this.dragCorner(e.x-e.dragHandle.offset.x,e.y-e.dragHandle.offset.y,e.dragHandle);break}}}catch(c){a.e(c)}finally{a.f()}null==e.dragHandle&&this.center.touchInBounds(e.x,e.y)&&(e.dragHandle=this.center,this.currentDragTouches.push(e),e.dragHandle.setDrag(!0),e.dragHandle.offset.x=e.x-e.dragHandle.position.x,e.dragHandle.offset.y=e.y-e.dragHandle.position.y,this.dragCenter(e.x-e.dragHandle.offset.x,e.y-e.dragHandle.offset.y,e.dragHandle))}}},{key:"updateClampBounds",value:function(){var t=this.srcImage.height/this.srcImage.width,e=this.canvas.width,i=this.canvas.height;this.canvas.height/this.canvas.width>t?(e=this.canvas.width,i=this.canvas.width*t):(i=this.canvas.height,e=this.canvas.height/t),this.minXClamp=this.canvas.width/2-e/2,this.minYClamp=this.canvas.height/2-i/2,this.maxXClamp=this.canvas.width/2+e/2,this.maxYClamp=this.canvas.height/2+i/2}},{key:"getCropBounds",value:function(){var t=this.getBounds();return t.top=Math.round((t.top-this.minYClamp)/this.ratioH),t.bottom=Math.round((t.bottom-this.minYClamp)/this.ratioH),t.left=Math.round((t.left-this.minXClamp)/this.ratioW),t.right=Math.round((t.right-this.minXClamp)/this.ratioW),t}},{key:"clampPosition",value:function(t,e){return t<this.minXClamp&&(t=this.minXClamp),t>this.maxXClamp&&(t=this.maxXClamp),e<this.minYClamp&&(e=this.minYClamp),e>this.maxYClamp&&(e=this.maxYClamp),(new b).instance.borrow(t,e)}},{key:"isImageSet",value:function(){return this.imageSet}},{key:"setImage",value:function(t){if(this.srcImage=t,t){this.imageSet=!0,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.buffer.getContext("2d").clearRect(0,0,this.buffer.width,this.buffer.height),this.cropperSettings.fileType||(this.fileType=this.getDataUriMimeType(t.src)),this.cropperSettings.minWithRelativeToResolution&&(this.minWidth=this.canvas.width*this.cropperSettings.minWidth/this.srcImage.width,this.minHeight=this.canvas.height*this.cropperSettings.minHeight/this.srcImage.height),this.updateClampBounds(),this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height;var e=this.getCropPositionFromMarkers();this.setCropPosition(e)}else this.imageSet=!1,this.draw(this.ctx)}},{key:"updateCropPosition",value:function(t){var e=this.getCropPositionFromBounds(t);this.setCropPosition(e)}},{key:"setCropPosition",value:function(e){this.tl.setPosition(e[0].x,e[0].y),this.tr.setPosition(e[1].x,e[1].y),this.bl.setPosition(e[2].x,e[2].y),this.br.setPosition(e[3].x,e[3].y),this.center.setPosition(e[4].x,e[4].y);var i,n=t(e);try{for(n.s();!(i=n.n()).done;){var s=i.value;(new b).instance.returnPoint(s)}}catch(r){n.e(r)}finally{n.f()}this.vertSquashRatio=this.detectVerticalSquash(this.srcImage),this.draw(this.ctx),this.croppedImage=this.getCroppedImageHelper(!1,this.cropWidth,this.cropHeight)}},{key:"getCropPositionFromMarkers",value:function(){var t,e,i,n,s=this.canvas.width,r=this.canvas.height,o=this.srcImage.height/this.srcImage.width,a=this.getBounds(),h=a.height/a.width,c=this.canvas.width/2,u=this.canvas.height/2;if(h>o){var p=Math.min(s*o,r),l=p/h;t=(new b).instance.borrow(c-l/2,u+p/2),e=(new b).instance.borrow(c+l/2,u+p/2),i=(new b).instance.borrow(c-l/2,u-p/2),n=(new b).instance.borrow(c+l/2,u-p/2)}else{var g=Math.min(r/o,s),d=g*h;t=(new b).instance.borrow(c-g/2,u+d/2),e=(new b).instance.borrow(c+g/2,u+d/2),i=(new b).instance.borrow(c-g/2,u-d/2),n=(new b).instance.borrow(c+g/2,u-d/2)}return[t,e,i,n,(new b).instance.borrow(c,u)]}},{key:"getCropPositionFromBounds",value:function(t){var e=0,i=0,n=this.srcImage.height/this.srcImage.width;this.canvasHeight/this.canvasWidth>n?e=this.buffer.height/2-this.canvasWidth*n/2:i=this.buffer.width/2-this.canvasHeight/n/2;var s=(this.canvasWidth-2*i)/this.srcImage.width,r=(this.canvasHeight-2*e)/this.srcImage.height,o=t.height*r,a=t.width*s,h=t.left*s+i,c=t.top*r+e;if(this.keepAspect){var u=o/this.aspectRatio,p=a*this.aspectRatio;this.getCropBounds().height===t.height?o=p:this.getCropBounds().width===t.width||Math.abs(p-o)<Math.abs(u-a)?a=u:o=p}return[(new b).instance.borrow(h,c+o),(new b).instance.borrow(h+a,c+o),(new b).instance.borrow(h,c),(new b).instance.borrow(h+a,c),(new b).instance.borrow(h+a/2,c+o/2)]}},{key:"getCroppedImageHelper",value:function(t,e,i){return this.cropperSettings.cropOnResize?this.getCroppedImage(t,e,i):this.croppedImage?this.croppedImage:document.createElement("img")}},{key:"getCroppedImage",value:function(t,e,i){var n=this.getBounds();if(this.srcImage){var s=this.srcImage.height/this.srcImage.width,r=this.canvas.height/this.canvas.width,o=this.canvas.width,a=this.canvas.height;r>s?(o=this.canvas.width,a=this.canvas.width*s):r<s?(a=this.canvas.height,o=this.canvas.height/s):(a=this.canvas.height,o=this.canvas.width),this.ratioW=o/this.srcImage.width,this.ratioH=a/this.srcImage.height;var h=(this.buffer.height-a)/2/this.ratioH,c=(this.buffer.width-o)/2/this.ratioW,u=this.cropCanvas.getContext("2d");if(this.cropperSettings.preserveSize||t){var p=Math.round(n.right/this.ratioW-n.left/this.ratioW),l=Math.round(n.bottom/this.ratioH-n.top/this.ratioH);this.cropCanvas.width=p,this.cropCanvas.height=l,this.cropperSettings.croppedWidth=this.cropCanvas.width,this.cropperSettings.croppedHeight=this.cropCanvas.height}else this.cropCanvas.width=this.cropWidth,this.cropCanvas.height=this.cropHeight;return u.clearRect(0,0,this.cropCanvas.width,this.cropCanvas.height),this.drawImageIOSFix(u,this.srcImage,Math.max(Math.round(n.left/this.ratioW-c),0),Math.max(Math.round(n.top/this.ratioH-h),0),Math.max(Math.round(n.width/this.ratioW),1),Math.max(Math.round(n.height/this.ratioH),1),0,0,this.cropCanvas.width,this.cropCanvas.height),this.cropperSettings.resampleFn&&this.cropperSettings.resampleFn(this.cropCanvas),this.croppedImage.width=this.cropCanvas.width,this.croppedImage.height=this.cropCanvas.height,this.croppedImage.src=this.cropCanvas.toDataURL(this.fileType,this.cropperSettings.compressRatio),this.croppedImage}return document.createElement("img")}},{key:"getBounds",value:function(){var e,i=Number.MAX_VALUE,n=Number.MAX_VALUE,s=-Number.MAX_VALUE,r=-Number.MAX_VALUE,o=t(this.markers);try{for(o.s();!(e=o.n()).done;){var a=e.value;a.position.x<i&&(i=a.position.x),a.position.x>s&&(s=a.position.x),a.position.y<n&&(n=a.position.y),a.position.y>r&&(r=a.position.y)}}catch(c){o.e(c)}finally{o.f()}var h=new C;return h.left=i,h.right=s,h.top=n,h.bottom=r,h}},{key:"setBounds",value:function(e){var i,n=this.getBounds(),s=t(this.markers);try{for(s.s();!(i=s.n()).done;){var r=i.value;r.setPosition(r.position.x===n.left?e.left:e.right,r.position.y===n.top?e.top:e.bottom)}}catch(o){s.e(o)}finally{s.f()}this.center.recalculatePosition(e),this.center.draw(this.ctx),this.draw(this.ctx)}},{key:"onTouchMove",value:function(t){if(this.crop.isImageSet()){if(1===t.touches.length){if(this.isMouseDown){t.preventDefault();for(var e=0;e<t.touches.length;e++){var i=t.touches[e],n=this.getTouchPos(this.canvas,i),s=new I(n.x,n.y,i.identifier);(new b).instance.returnPoint(n),this.move(s)}}}else if(2===t.touches.length){t.preventDefault();var r=(t.touches[0].clientX-t.touches[1].clientX)*(t.touches[0].clientX-t.touches[1].clientX)+(t.touches[0].clientY-t.touches[1].clientY)*(t.touches[0].clientY-t.touches[1].clientY);if(this.previousDistance&&this.previousDistance!==r){var o=this.getBounds();r<this.previousDistance&&(o.top+=1,o.left+=1,o.right-=1,o.bottom-=1),r>this.previousDistance&&(o.top!==this.minYClamp&&o.bottom!==this.maxYClamp&&o.left!==this.minXClamp&&o.right!==this.maxXClamp?(o.top-=1,o.left-=1,o.right+=1,o.bottom+=1):o.top!==this.minYClamp&&o.bottom!==this.maxYClamp&&o.left===this.minXClamp&&o.right!==this.maxXClamp?(o.top-=1,o.right+=2,o.bottom+=1):o.top!==this.minYClamp&&o.bottom!==this.maxYClamp&&o.left!==this.minXClamp&&o.right===this.maxXClamp?(o.top-=1,o.left-=2,o.bottom+=1):o.top===this.minYClamp&&o.bottom!==this.maxYClamp&&o.left!==this.minXClamp&&o.right!==this.maxXClamp?(o.left-=1,o.right+=1,o.bottom+=2):o.top!==this.minYClamp&&o.bottom===this.maxYClamp&&o.left!==this.minXClamp&&o.right!==this.maxXClamp?(o.top-=2,o.left-=1,o.right+=1):o.top===this.minYClamp&&o.bottom!==this.maxYClamp&&o.left===this.minXClamp&&o.right!==this.maxXClamp?(o.right+=2,o.bottom+=2):o.top===this.minYClamp&&o.bottom!==this.maxYClamp&&o.left!==this.minXClamp&&o.right===this.maxXClamp?(o.left-=2,o.bottom+=2):o.top!==this.minYClamp&&o.bottom===this.maxYClamp&&o.left===this.minXClamp&&o.right!==this.maxXClamp?(o.top-=2,o.right+=2):o.top!==this.minYClamp&&o.bottom===this.maxYClamp&&o.left!==this.minXClamp&&o.right===this.maxXClamp&&(o.top-=2,o.left-=2)),o.top<this.minYClamp&&(o.top=this.minYClamp),o.bottom>this.maxYClamp&&(o.bottom=this.maxYClamp),o.left<this.minXClamp&&(o.left=this.minXClamp),o.right>this.maxXClamp&&(o.right=this.maxXClamp),this.setBounds(o)}this.previousDistance=r}this.draw(this.ctx)}}},{key:"onMouseMove",value:function(t){if(this.crop.isImageSet()&&this.isMouseDown){var e=this.getMousePos(this.canvas,t);this.move(new I(e.x,e.y,0));var i=this.getDragTouchForID(0);i?(i.x=e.x,i.y=e.y):i=new I(e.x,e.y,0),(new b).instance.returnPoint(e),this.drawCursors(i),this.draw(this.ctx)}}},{key:"move",value:function(t){this.isMouseDown&&this.handleMove(t)}},{key:"getDragTouchForID",value:function(t){for(var e=0;e<this.currentDragTouches.length;e++)if(t===this.currentDragTouches[e].id)return this.currentDragTouches[e]}},{key:"drawCursors",value:function(t){var e=!1;null!=t&&(t.dragHandle===this.center&&(this.imageCropperDataShare.setStyle(this.canvas,"move"),e=!0),null!==t.dragHandle&&t.dragHandle instanceof x&&(this.drawCornerCursor(t.dragHandle,t.dragHandle.position.x,t.dragHandle.position.y),e=!0));var i=!1;if(!e){for(var n=0;n<this.markers.length;n++)i=i||this.drawCornerCursor(this.markers[n],t.x,t.y);i||this.imageCropperDataShare.setStyle(this.canvas,"initial")}i||e||!this.center.touchInBounds(t.x,t.y)?this.center.setOver(!1):(this.center.setOver(!0),this.imageCropperDataShare.setOver(this.canvas),this.imageCropperDataShare.setStyle(this.canvas,"move"))}},{key:"drawCornerCursor",value:function(t,e,i){return t.touchInBounds(e,i)?(t.setOver(!0),t.getHorizontalNeighbour().position.x>t.position.x?t.getVerticalNeighbour().position.y>t.position.y?(this.imageCropperDataShare.setOver(this.canvas),this.imageCropperDataShare.setStyle(this.canvas,"nwse-resize")):(this.imageCropperDataShare.setOver(this.canvas),this.imageCropperDataShare.setStyle(this.canvas,"nesw-resize")):t.getVerticalNeighbour().position.y>t.position.y?(this.imageCropperDataShare.setOver(this.canvas),this.imageCropperDataShare.setStyle(this.canvas,"nesw-resize")):(this.imageCropperDataShare.setOver(this.canvas),this.imageCropperDataShare.setStyle(this.canvas,"nwse-resize")),!0):(t.setOver(!1),!1)}},{key:"onTouchStart",value:function(e){if(this.crop.isImageSet()){var i=e.touches[0],n=this.getTouchPos(this.canvas,i),s=new I(n.x,n.y,i.identifier);(new b).instance.returnPoint(n),this.isMouseDown=!1;var r,o=t(this.markers);try{for(o.s();!(r=o.n()).done;){r.value.touchInBounds(s.x,s.y)&&(this.isMouseDown=!0)}}catch(a){o.e(a)}finally{o.f()}this.center.touchInBounds(s.x,s.y)&&(this.isMouseDown=!0)}}},{key:"onTouchEnd",value:function(t){if(this.crop.isImageSet()){for(var e=0;e<t.changedTouches.length;e++){var i=this.getDragTouchForID(t.changedTouches[e].identifier);i&&void 0!==i&&((i.dragHandle instanceof x||i.dragHandle instanceof k)&&i.dragHandle.setOver(!1),this.handleRelease(i))}0===this.currentDragTouches.length&&(this.isMouseDown=!1,this.currentlyInteracting=!1)}}},{key:"drawImageIOSFix",value:function(t,e,i,n,s,r,o,a,h,c){t.drawImage(e,i,n,s,r,o,a,h,c)}},{key:"onMouseDown",value:function(t){this.crop.isImageSet()&&(this.isMouseDown=!0)}},{key:"onMouseUp",value:function(t){this.crop.isImageSet()&&(this.imageCropperDataShare.setReleased(this.canvas),this.isMouseDown=!1,this.handleRelease(new I(0,0,0)))}}]),o}(function(){return function t(){g(this,t)}}()),M=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;g(this,t),this.x=+e,this.y=+i,this.w=+n,this.h=+s}return l(t,[{key:"toBounds",value:function(){return new C(this.x,this.y,this.w,this.h)}},{key:"isInitialized",value:function(){return 0!==this.x&&0!==this.y&&0!==this.w&&0!==this.h}}]),t}(),R=function(){var t=function(){function t(e,i){g(this,t),this.document=i,this.cropPositionChange=new h.EventEmitter,this.exif=new w,this.onCrop=new h.EventEmitter,this.imageSet=new h.EventEmitter,this.dragUnsubscribers=[],this.renderer=e}return l(t,[{key:"ngAfterViewInit",value:function(){var t=this.cropcanvas.nativeElement;this.settings||(this.settings=new m),this.settings.cropperClass&&this.renderer.setAttribute(t,"class",this.settings.cropperClass),this.settings.dynamicSizing?(this.windowListener=this.resize.bind(this),window.addEventListener("resize",this.windowListener)):(this.renderer.setAttribute(t,"width",this.settings.canvasWidth.toString()),this.renderer.setAttribute(t,"height",this.settings.canvasHeight.toString())),this.cropper||(this.cropper=new D(this.settings)),this.cropper.prepare(t)}},{key:"ngOnChanges",value:function(t){if(this.isCropPositionChanged(t)){if(this.cropper.updateCropPosition(this.cropPosition.toBounds()),this.cropper.isImageSet()){var e=this.cropper.getCropBounds();this.image.image=this.cropper.getCroppedImageHelper().src,this.onCrop.emit(e)}this.updateCropBounds()}t.inputImage&&this.setImage(t.inputImage.currentValue),t.settings&&this.cropper&&(this.cropper.updateSettings(this.settings),this.cropper.isImageSet()&&(this.image.image=this.cropper.getCroppedImageHelper().src,this.onCrop.emit(this.cropper.getCropBounds())))}},{key:"ngOnDestroy",value:function(){this.removeDragListeners(),this.settings.dynamicSizing&&this.windowListener&&window.removeEventListener("resize",this.windowListener)}},{key:"onTouchMove",value:function(t){this.cropper.onTouchMove(t)}},{key:"onTouchStart",value:function(t){this.cropper.onTouchStart(t)}},{key:"onTouchEnd",value:function(t){this.cropper.onTouchEnd(t),this.cropper.isImageSet()&&(this.image.image=this.cropper.getCroppedImageHelper().src,this.onCrop.emit(this.cropper.getCropBounds()),this.updateCropBounds())}},{key:"onMouseDown",value:function(t){this.dragUnsubscribers.push(this.renderer.listen(this.document,"mousemove",this.onMouseMove.bind(this))),this.dragUnsubscribers.push(this.renderer.listen(this.document,"mouseup",this.onMouseUp.bind(this))),this.cropper.onMouseDown(t)}},{key:"removeDragListeners",value:function(){this.dragUnsubscribers.forEach((function(t){return t()}))}},{key:"onMouseUp",value:function(t){this.removeDragListeners(),this.cropper.isImageSet()&&(this.cropper.onMouseUp(t),this.image.image=this.cropper.getCroppedImageHelper().src,this.onCrop.emit(this.cropper.getCropBounds()),this.updateCropBounds())}},{key:"onMouseMove",value:function(t){this.cropper.onMouseMove(t)}},{key:"fileChangeListener",value:function(t){var e=this;if(0!==t.target.files.length){var i=t.target.files[0];if(this.settings.allowedFilesRegex.test(i.name)){var n=new Image,s=new FileReader;s.addEventListener("loadend",(function(t){n.addEventListener("load",(function(){e.setImage(n)})),n.src=t.target.result})),s.readAsDataURL(i)}}}},{key:"resize",value:function(){var t=this.cropcanvas.nativeElement;this.settings.canvasWidth=t.offsetWidth,this.settings.canvasHeight=t.offsetHeight,this.cropper.resizeCanvas(t.offsetWidth,t.offsetHeight,!0)}},{key:"reset",value:function(){this.cropper.reset(),this.renderer.setAttribute(this.cropcanvas.nativeElement,"class",this.settings.cropperClass),this.image.image=this.cropper.getCroppedImageHelper().src}},{key:"setImage",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.imageSet.emit(!0),this.renderer.setAttribute(this.cropcanvas.nativeElement,"class","".concat(this.settings.cropperClass," ").concat(this.settings.croppingClass)),this.raf=window.requestAnimationFrame((function(){e.raf&&window.cancelAnimationFrame(e.raf),t.naturalHeight>0&&t.naturalWidth>0&&(t.height=t.naturalHeight,t.width=t.naturalWidth,window.cancelAnimationFrame(e.raf),e.getOrientedImage(t,(function(n){if(e.settings.dynamicSizing){var s=e.cropcanvas.nativeElement;e.settings.canvasWidth=s.offsetWidth,e.settings.canvasHeight=s.offsetHeight,e.cropper.resizeCanvas(s.offsetWidth,s.offsetHeight,!1)}e.cropper.setImage(n),e.cropPosition&&e.cropPosition.isInitialized()&&e.cropper.updateCropPosition(e.cropPosition.toBounds()),e.image.original=n;var r=e.cropper.getCropBounds();e.image.image=e.cropper.getCroppedImageHelper().src,e.image||(e.image=t),null!=i&&(r=i,e.cropper.setBounds(r),e.cropper.updateCropPosition(r)),e.onCrop.emit(r)})))}))}},{key:"isCropPositionChanged",value:function(t){return!!(this.cropper&&t.cropPosition&&this.isCropPositionUpdateNeeded)||(this.isCropPositionUpdateNeeded=!0,!1)}},{key:"updateCropBounds",value:function(){var t=this.cropper.getCropBounds();this.cropPositionChange.emit(new M(t.left,t.top,t.width,t.height)),this.isCropPositionUpdateNeeded=!1}},{key:"getOrientedImage",value:function(t,e){var i,n=this;this.exif.getData(t,(function(){var s=n.exif.getTag(t,"Orientation");if([3,6,8].indexOf(s)>-1){var r=document.createElement("canvas"),o=r.getContext("2d"),a=t.width,h=t.height,c=0,u=0,p=0;switch(s){case 3:c=-t.width,u=-t.height,p=180;break;case 6:a=t.height,h=t.width,u=-t.height,p=90;break;case 8:a=t.height,h=t.width,c=-t.width,p=270}r.width=a,r.height=h,o.rotate(p*Math.PI/180),o.drawImage(t,c,u),(i=document.createElement("img")).width=a,i.height=h,i.addEventListener("load",(function(){e(i)})),i.src=r.toDataURL("image/png")}else e(i=t)}))}}]),t}();return t.\u0275fac=function(e){return new(e||t)(h["\u0275\u0275directiveInject"](h.Renderer2),h["\u0275\u0275directiveInject"](c.e))},t.\u0275cmp=h["\u0275\u0275defineComponent"]({type:t,selectors:[["img-cropper"]],viewQuery:function(t,e){var i;1&t&&(h["\u0275\u0275staticViewQuery"](u,!0),h["\u0275\u0275viewQuery"](p,!0)),2&t&&(h["\u0275\u0275queryRefresh"](i=h["\u0275\u0275loadQuery"]())&&(e.cropcanvas=i.first),h["\u0275\u0275queryRefresh"](i=h["\u0275\u0275loadQuery"]())&&(e.fileInput=i.first))},inputs:{settings:"settings",cropper:"cropper",image:"image",inputImage:"inputImage",cropPosition:"cropPosition"},outputs:{cropPositionChange:"cropPositionChange",onCrop:"onCrop",imageSet:"imageSet"},features:[h["\u0275\u0275NgOnChangesFeature"]()],decls:4,vars:1,consts:[[1,"ng2-imgcrop"],["type","file","accept","image/*",3,"change",4,"ngIf"],[3,"mousedown","touchmove","touchend","touchstart"],["cropcanvas",""],["type","file","accept","image/*",3,"change"],["fileInput",""]],template:function(t,e){1&t&&(h["\u0275\u0275elementStart"](0,"span",0),h["\u0275\u0275template"](1,d,2,0,"input",1),h["\u0275\u0275elementStart"](2,"canvas",2,3),h["\u0275\u0275listener"]("mousedown",(function(t){return e.onMouseDown(t)}))("touchmove",(function(t){return e.onTouchMove(t)}))("touchend",(function(t){return e.onTouchEnd(t)}))("touchstart",(function(t){return e.onTouchStart(t)})),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"]()),2&t&&(h["\u0275\u0275advance"](1),h["\u0275\u0275property"]("ngIf",!e.settings.noFileInput))},directives:[c.p],encapsulation:2}),t}(),F=function(){var t=function t(){g(this,t)};return t.\u0275mod=h["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=h["\u0275\u0275defineInjector"]({factory:function(e){return new(e||t)},imports:[[c.c]]}),t}()}}])}();